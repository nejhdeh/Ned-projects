pn = [];

pn = [pn              7029]; % 0 7029
pn = [pn              7030]; % 0 7030
pn = [pn              7045]; % 0 7045
pn = [pn              7050]; % 0 7050
pn = [pn              7069]; % 0 7069
pn = [pn              7072]; % 0 7072
pn = [pn              7075]; % 0 7075
pn = [pn              8005]; % 0 8005
pn = [pn              8029]; % 0 8029
pn = [pn              8033]; % 0 8033
pn = [pn              8035]; % 0 8035
pn = [pn              8039]; % 0 8039
pn = [pn              8043]; % 0 8043
pn = [pn              8053]; % 0 8053
pn = [pn              8501]; % 0 8501
pn = [pn              8502]; % 0 8502
pn = [pn              8503]; % 0 8503
pn = [pn              8516]; % 0 8516
pn = [pn              8528]; % 0 8528
pn = [pn              8540]; % 0 8540
pn = [pn              7021]; % 0 7021
pn = [pn              7025]; % 0 7025
pn = [pn              7028]; % 0 7028
pn = [pn              7034]; % 0 7034
pn = [pn              7035]; % 0 7035
pn = [pn              7040]; % 0 7040
pn = [pn              7046]; % 0 7046
pn = [pn              7048]; % 0 7048
pn = [pn              7053]; % 0 7053
pn = [pn              7057]; % 0 7057
pn = [pn              7060]; % 0 7060
pn = [pn              7063]; % 0 7063
pn = [pn              7064]; % 0 7064
pn = [pn              7065]; % 0 7065
pn = [pn              7066]; % 0 7066
pn = [pn              7067]; % 0 7067
pn = [pn              7068]; % 0 7068
pn = [pn              7074]; % 0 7074
pn = [pn              7080]; % 0 7080
pn = [pn              8003]; % 0 8003
pn = [pn              8006]; % 0 8006
pn = [pn              8010]; % 0 8010
pn = [pn              8014]; % 0 8014
pn = [pn              8016]; % 0 8016
pn = [pn              8020]; % 0 8020
pn = [pn              8021]; % 0 8021
pn = [pn              8038]; % 0 8038
pn = [pn              8041]; % 0 8041
pn = [pn              8042]; % 0 8042
pn = [pn              8048]; % 0 8048
pn = [pn              8049]; % 0 8049
pn = [pn              8052]; % 0 8052
pn = [pn              8054]; % 0 8054
pn = [pn              8505]; % 0 8505
pn = [pn              8506]; % 0 8506
pn = [pn              8514]; % 0 8514
pn = [pn              8517]; % 0 8517
pn = [pn              8519]; % 0 8519
pn = [pn              8520]; % 0 8520
pn = [pn              8525]; % 0 8525
pn = [pn              8532]; % 0 8532
pn = [pn              8535]; % 0 8535
pn = [pn              8537]; % 0 8537
pn = [pn              8539]; % 0 8539
pn = [pn              7033]; % 0 7033
pn = [pn              7037]; % 0 7037
pn = [pn              7044]; % 0 7044
pn = [pn              7052]; % 0 7052
pn = [pn              7054]; % 0 7054
pn = [pn              7055]; % 0 7055
pn = [pn              7061]; % 0 7061
pn = [pn              7073]; % 0 7073
pn = [pn              8025]; % 0 8025
pn = [pn              8040]; % 0 8040
pn = [pn              8047]; % 0 8047
pn = [pn              8504]; % 0 8504
pn = [pn              8510]; % 0 8510
pn = [pn              8511]; % 0 8511
pn = [pn              8513]; % 0 8513
pn = [pn              8521]; % 0 8521
pn = [pn              8524]; % 0 8524
pn = [pn              8529]; % 0 8529
pn = [pn              8533]; % 0 8533
pn = [pn              8534]; % 0 8534
pn = [pn              7022]; % 0 7022
pn = [pn              7023]; % 0 7023
pn = [pn              7024]; % 0 7024
pn = [pn              7026]; % 0 7026
pn = [pn              7027]; % 0 7027
pn = [pn              7031]; % 0 7031
pn = [pn              7032]; % 0 7032
pn = [pn              7036]; % 0 7036
pn = [pn              7038]; % 0 7038
pn = [pn              7041]; % 0 7041
pn = [pn              7047]; % 0 7047
pn = [pn              7058]; % 0 7058
pn = [pn              7059]; % 0 7059
pn = [pn              7071]; % 0 7071
pn = [pn              7076]; % 0 7076
pn = [pn              7077]; % 0 7077
pn = [pn              7078]; % 0 7078
pn = [pn              7079]; % 0 7079
pn = [pn              8002]; % 0 8002
pn = [pn              8004]; % 0 8004
pn = [pn              8008]; % 0 8008
pn = [pn              8011]; % 0 8011
pn = [pn              8012]; % 0 8012
pn = [pn              8013]; % 0 8013
pn = [pn              8015]; % 0 8015
pn = [pn              8017]; % 0 8017
pn = [pn              8024]; % 0 8024
pn = [pn              8027]; % 0 8027
pn = [pn              8030]; % 0 8030
pn = [pn              8031]; % 0 8031
pn = [pn              8032]; % 0 8032
pn = [pn              8034]; % 0 8034
pn = [pn              8036]; % 0 8036
pn = [pn              8037]; % 0 8037
pn = [pn              8044]; % 0 8044
pn = [pn              8046]; % 0 8046
pn = [pn              8051]; % 0 8051
pn = [pn              8507]; % 0 8507
pn = [pn              8515]; % 0 8515
pn = [pn              8523]; % 0 8523
pn = [pn              8527]; % 0 8527
pn = [pn              8530]; % 0 8530
pn = [pn              8536]; % 0 8536
pn = [pn              8538]; % 0 8538
pn = [pn              10020]; % 0 10020
pn = [pn              10030]; % 0 10030
pn = [pn              10040]; % 0 10040
pn = [pn              10050]; % 0 10050
pn = [pn              10065]; % 0 10065
pn = [pn              10070]; % 0 10070
pn = [pn              10090]; % 0 10090
pn = [pn              10100]; % 0 10100
pn = [pn              10110]; % 0 10110
pn = [pn              10120]; % 0 10120
pn = [pn              10130]; % 0 10130
pn = [pn              10140]; % 0 10140
pn = [pn              10150]; % 0 10150
pn = [pn              10160]; % 0 10160
pn = [pn              10170]; % 0 10170
pn = [pn              10180]; % 0 10180
pn = [pn              10190]; % 0 10190
pn = [pn              10200]; % 0 10200
pn = [pn              10210]; % 0 10210
pn = [pn              10220]; % 0 10220
pn = [pn              10230]; % 0 10230
pn = [pn              10250]; % 0 10250
pn = [pn              10270]; % 0 10270
pn = [pn              10280]; % 0 10280
pn = [pn              10290]; % 0 10290
pn = [pn              10300]; % 0 10300
pn = [pn              10310]; % 0 10310
pn = [pn              10320]; % 0 10320
pn = [pn              10330]; % 0 10330
pn = [pn              10345]; % 0 10345
pn = [pn              10350]; % 0 10350
pn = [pn              10360]; % 0 10360
pn = [pn              10370]; % 0 10370
pn = [pn              10385]; % 0 10385
pn = [pn              10390]; % 0 10390
pn = [pn              10400]; % 0 10400
pn = [pn              10420]; % 0 10420
pn = [pn              10430]; % 0 10430
pn = [pn              10440]; % 0 10440
pn = [pn              10450]; % 0 10450
pn = [pn              10460]; % 0 10460
pn = [pn              10470]; % 0 10470
pn = [pn              10480]; % 0 10480
pn = [pn              10500]; % 0 10500
pn = [pn              10510]; % 0 10510
pn = [pn              10520]; % 0 10520
pn = [pn              10540]; % 0 10540
pn = [pn              10550]; % 0 10550
pn = [pn              10560]; % 0 10560
pn = [pn              10570]; % 0 10570
pn = [pn              10590]; % 0 10590
pn = [pn              10615]; % 0 10615
pn = [pn              10640]; % 0 10640
pn = [pn              10670]; % 0 10670
pn = [pn              10680]; % 0 10680
pn = [pn              10690]; % 0 10690
pn = [pn              10700]; % 0 10700
pn = [pn              10710]; % 0 10710
pn = [pn              10720]; % 0 10720
pn = [pn              10740]; % 0 10740
pn = [pn              10750]; % 0 10750
pn = [pn              10760]; % 0 10760
pn = [pn              10770]; % 0 10770
pn = [pn              10790]; % 0 10790
pn = [pn              10800]; % 0 10800
pn = [pn              10011]; % 0 10011
pn = [pn              10013]; % 0 10013
pn = [pn              10021]; % 0 10021
pn = [pn              10022]; % 0 10022
pn = [pn              10023]; % 0 10023
pn = [pn              10062]; % 0 10062
pn = [pn              10071]; % 0 10071
pn = [pn              10073]; % 0 10073
pn = [pn              10082]; % 0 10082
pn = [pn              10083]; % 0 10083
pn = [pn              10084]; % 0 10084
pn = [pn              10092]; % 0 10092
pn = [pn              10093]; % 0 10093
pn = [pn              10121]; % 0 10121
pn = [pn              10122]; % 0 10122
pn = [pn              10123]; % 0 10123
pn = [pn              10151]; % 0 10151
pn = [pn              10171]; % 0 10171
pn = [pn              10172]; % 0 10172
pn = [pn              10191]; % 0 10191
pn = [pn              10192]; % 0 10192
pn = [pn              10193]; % 0 10193
pn = [pn              10202]; % 0 10202
pn = [pn              10203]; % 0 10203
pn = [pn              10210]; % 0 10210
pn = [pn              10252]; % 0 10252
pn = [pn              10261]; % 0 10261
pn = [pn              10263]; % 0 10263
pn = [pn              10271]; % 0 10271
pn = [pn              10272]; % 0 10272
pn = [pn              10273]; % 0 10273
pn = [pn              10281]; % 0 10281
pn = [pn              10291]; % 0 10291
pn = [pn              10293]; % 0 10293
pn = [pn              10301]; % 0 10301
pn = [pn              10312]; % 0 10312
pn = [pn              10313]; % 0 10313
pn = [pn              10321]; % 0 10321
pn = [pn              10322]; % 0 10322
pn = [pn              10323]; % 0 10323
pn = [pn              10331]; % 0 10331
pn = [pn              10333]; % 0 10333
pn = [pn              10342]; % 0 10342
pn = [pn              10343]; % 0 10343
pn = [pn              10351]; % 0 10351
pn = [pn              10352]; % 0 10352
pn = [pn              10353]; % 0 10353
pn = [pn              10361]; % 0 10361
pn = [pn              10362]; % 0 10362
pn = [pn              10363]; % 0 10363
pn = [pn              10371]; % 0 10371
pn = [pn              10372]; % 0 10372
pn = [pn              10382]; % 0 10382
pn = [pn              10383]; % 0 10383
pn = [pn              10401]; % 0 10401
pn = [pn              10402]; % 0 10402
pn = [pn              10403]; % 0 10403
pn = [pn              10451]; % 0 10451
pn = [pn              10452]; % 0 10452
pn = [pn              10461]; % 0 10461
pn = [pn              10462]; % 0 10462
pn = [pn              10463]; % 0 10463
pn = [pn              10472]; % 0 10472
pn = [pn              10483]; % 0 10483
pn = [pn              10491]; % 0 10491
pn = [pn              10492]; % 0 10492
pn = [pn              10493]; % 0 10493
pn = [pn              10521]; % 0 10521
pn = [pn              10523]; % 0 10523
pn = [pn              10531]; % 0 10531
pn = [pn              10532]; % 0 10532
pn = [pn              10533]; % 0 10533
pn = [pn              10541]; % 0 10541
pn = [pn              10542]; % 0 10542
pn = [pn              10543]; % 0 10543
pn = [pn              10551]; % 0 10551
pn = [pn              10552]; % 0 10552
pn = [pn              10591]; % 0 10591
pn = [pn              10593]; % 0 10593
pn = [pn              10612]; % 0 10612
pn = [pn              10621]; % 0 10621
pn = [pn              10622]; % 0 10622
pn = [pn              10623]; % 0 10623
pn = [pn              10632]; % 0 10632
pn = [pn              10634]; % 0 10634
pn = [pn              10662]; % 0 10662
pn = [pn              10663]; % 0 10663
pn = [pn              10671]; % 0 10671
pn = [pn              10672]; % 0 10672
pn = [pn              10673]; % 0 10673
pn = [pn              10681]; % 0 10681
pn = [pn              10682]; % 0 10682
pn = [pn              10683]; % 0 10683
pn = [pn              10691]; % 0 10691
pn = [pn              10692]; % 0 10692
pn = [pn              10693]; % 0 10693
pn = [pn              10701]; % 0 10701
pn = [pn              10711]; % 0 10711
pn = [pn              10712]; % 0 10712
pn = [pn              10713]; % 0 10713
pn = [pn              10721]; % 0 10721
pn = [pn              10732]; % 0 10732
pn = [pn              10742]; % 0 10742
pn = [pn              10743]; % 0 10743
pn = [pn              10751]; % 0 10751
pn = [pn              10753]; % 0 10753
pn = [pn              10761]; % 0 10761
pn = [pn              10762]; % 0 10762
pn = [pn              10763]; % 0 10763
pn = [pn              10782]; % 0 10782
pn = [pn              10783]; % 0 10783
pn = [pn              10791]; % 0 10791
pn = [pn              10793]; % 0 10793
pn = [pn              10801]; % 0 10801
pn = [pn              10802]; % 0 10802
pn = [pn              10803]; % 0 10803

data = [];
QTc=[zeros(1,34)];
RR=[zeros(1,34)];
RPeak = [zeros(1,34)];
TPeak = [zeros(1,34)];

for i=1:length(pn)
    i
    pn(i)
    if pn(i) >= 8000
        try
            QT_mat = get_Data(pn(i),'QT');
		    RR_mat = get_Data(pn(i),'RR');
		    RPeak_mat = get_Data(pn(i),'RPeak');
		    TPeak_mat = get_Data(pn(i),'TPeak');
		    HR = get_Data(pn(i),'HR');
            HRO = get_Data(pn(i),'HRO');
            STUDYSTART = get_Data(pn(i),'StudyStart');
        catch
            continue;
        end
        
        dim = size(RR_mat,1);
        QTc_plus = zeros(dim,33);
        RR_plus = zeros(dim,33);
        RPeak_plus = zeros(dim,33);
        TPeak_plus = zeros(dim,33);
        for j=1:min(16,size(RR_mat,2));
            QTc_plus(:,j) = QT_mat(:,j);
            RR_plus(:,j) = RR_mat(:,j);
            RPeak_plus(:,j) = RPeak_mat(:,j);
            TPeak_plus(:,j) = TPeak_mat(:,j);
        end
        QTc = [QTc ; [ones(dim,1)*pn(i) QTc_plus]];
        RR = [RR ; [ones(dim,1)*pn(i) RR_plus]];
        RPeak = [RPeak ; [ones(dim,1)*pn(i) RPeak_plus]];
        TPeak = [TPeak ; [ones(dim,1)*pn(i) TPeak_plus]];
        
        QT = QT_mat(:,2:end);
        dudQT = find(QT<70 | QT>122);
        QT(dudQT)=NaN;
		
        RRR = RR_mat(:,2:end);
        dudRR = find(RRR<0.4*256 | RRR>1.7*256);
        RRR(dudRR)=NaN;
        
        QTc_mat = ((QT / 256) ./ sqrt(RRR / 256)) * 1000; % milliseconds
	    RRR = 1000 * RRR / 256;
        
		% first column in above is time, other colums are the values
		% 
		% matrix sizes are given by (total cycles) by (15 values)
		% 
		% 1. convert from samples 256 samp/s to seconds (must be seconds because of )
		% 2. use formula QTc = QT/sqrt(RR)
		% 3. convert final QTc into into milliseconds for convention
		%     4. find average () QTc per cycle
		%     
		%     
		%     notes:
		%     
		%     you will find many NaN if in either matrix QTc
            
		
		
		for j=1:length(RR_mat(:,1))
            
             Q = find(~isnan(QTc_mat(j,:)));
             R = find(~isnan(RRR(j,:)));
%             if isempty(Q)
%                  QTc_mean = -100;
%                  QTc_stdev = -100;
%                  QTc_median = -100;
%              else
                QTc_mean = nanmean([QTc_mat(j,:) -100]);
                QTc_stdev = nanstd([QTc_mat(j,:) -100]);
                QTc_median = nanmedian([QTc_mat(j,:) -100]);
                QTc_max = nanmax([QTc_mat(j,:) -100]); %avoid zero length
                RR_mean = nanmean([RRR(j,:) -100]);
                RR_stdev = nanstd([RRR(j,:) -100]);
                RR_median = nanmedian([RRR(j,:) -100]);
%             end
            
            data = [data; pn(i) length(Q) (RR_mat(j,1)-STUDYSTART)*24 QTc_mean QTc_stdev QTc_median QTc_max length(R) RR_mean RR_stdev RR_median];
        end
    end
end

fid = fopen('H:/DarwinWorkspace/Data of Unscaled Algorithm/QTcData.csv','w')
fprintf(fid,'PatNo,Valid Q measurements, time,QTc_mean,QTc_stdev,QTc_median, QTc_max Valid RR measurements, RR_mean, RR_stdev, RR_median\n');
for i=1:size(data,1)
    fprintf(fid,'%d,%d, %12.8f,%12.8f,%12.8f,%12.8f, %12.8f,%d,%12.8f,%12.8f,%12.8f\n',data(i,:));
end
fclose(fid);
csvwrite('H:/DarwinWorkspace/Data of Unscaled Algorithm/QTc_obs.csv',QTc);
csvwrite('H:/DarwinWorkspace/Data of Unscaled Algorithm/RR_obs.csv',RR);
csvwrite('H:/DarwinWorkspace/Data of Unscaled Algorithm/RPeak_obs.csv',RPeak);
csvwrite('H:/DarwinWorkspace/Data of Unscaled Algorithm/TPeak_obs.csv',TPeak);


