Select data.BGL
from
(select StudySessionData.PatientIndex, StudySessionData.StudySessionID
from StudySessionData) Study
inner join
(select (case when Machine = 1 then YSI1 else YSI2 end) as BGL, BGLData.PatientIndex, BGLData.BGLTime as time
From BGLData) as data
on Study.PatientIndex = data.PatientIndex
where Study.StudySessionID = #StudySessionID
order by data.time
